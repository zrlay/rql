!function(e){function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var t={};r.m=e,r.c=t,r.d=function(exports,e,t){r.o(exports,e)||Object.defineProperty(exports,e,{configurable:!1,enumerable:!0,get:t})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=1)}([function(e,exports,r){var t,n;t=[exports,r(2)],void 0!==(n=function(exports,e){function r(r,o){function i(r){c.args.push(r),c=r,e(exports.lastSeen,c.name)&&(s.cache[c.name]=c.args)}function a(e){if(c.name){if(c.name!==e)throw new Error("Can not mix conjunctions within a group, use paranthesis around each set of same conjuctions (& and |)")}else c.name=e}function u(e){if(e&&e.args){delete e.parent;for(var r=e.args,t=0,n=r.length;t<n;t++)u(r[t])}return e}void 0!==r&&null!==r||(r="");var c=new exports.Query,s=c;s.cache={};var f=s.name;if(s.name="","object"==typeof r){if(r instanceof exports.Query)return r;for(var l in r){var c=new exports.Query;s.args.push(c),c.name="eq",c.args=[l,r[l]]}return s}if("?"===r.charAt(0))throw new URIError("Query must not start with ?");exports.jsonQueryCompatible&&(r=r.replace(/%3C=/g,"=le=").replace(/%3E=/g,"=ge=").replace(/%3C/g,"=lt=").replace(/%3E/g,"=gt=")),r.indexOf("/")>-1&&(r=r.replace(/[\+\*\$\-:\w%\._]*\/[\+\*\$\-:\w%\._\/]*/g,function(e){return"("+e.replace(/\//g,",")+")"})),r=r.replace(/(\([\+\*\$\-:\w%\._,]+\)|[\+\*\$\-:\w%\._]*|)([<>!]?=(?:[\w]*=)?|>|<)(\([\+\*\$\-:\w%\._,]+\)|[\+\*\$\-:\w%\._]*|)/g,function(e,r,t,o){if(t.length<3){if(!n[t])throw new URIError("Illegal operator "+t);t=n[t]}else t=t.substring(1,t.length-1);return t+"("+r+","+o+")"}),"?"===r.charAt(0)&&(r=r.substring(1));var p=r.replace(/(\))|([&\|,])?([\+\*\$\-:\w%\._]*)(\(?)/g,function(r,n,u,f,l){if(u&&("&"===u&&a("and"),"|"===u&&a("or")),l){var p=new exports.Query;p.name=f,p.parent=c,i(p)}else if(n){var h=!c.name;if(!(c=c.parent))throw new URIError("Closing paranthesis without an opening paranthesis");h&&c.args.push(c.args.pop().args)}else if((f||","===u)&&(c.args.push(t(f,o)),e(exports.lastSeen,c.name)&&(s.cache[c.name]=c.args),"eq"===c.name&&c.args[0]===exports.primaryKeyName)){var d=c.args[1];!d||d instanceof RegExp||(d=d.toString()),s.cache[exports.primaryKeyName]=d}return""});if(c.parent)throw new URIError("Opening paranthesis without a closing paranthesis");if(p)throw new URIError("Illegal character in query string encountered "+p);return u(s),s.name||(s.name=f),s}function t(e,r){var t=exports.converters.default;if("$"===e.charAt(0)){var n=parseInt(e.substring(1))-1;return n>=0&&r?r[n]:void 0}if(e.indexOf(":")>-1){var o=e.split(":");if(!(t=exports.converters[o[0]]))throw new URIError("Unknown converter "+o[0]);e=o.slice(1).join(":")}return t(e)}var n={"=":"eq","==":"eq",">":"gt",">=":"ge","<":"lt","<=":"le","!=":"ne"};exports.primaryKeyName="id",exports.lastSeen=["sort","select","values","limit"],exports.jsonQueryCompatible=!0,exports.parse=exports.parseQuery=r,exports.parseGently=function(){var e;try{e=r.apply(this,arguments)}catch(r){e=new exports.Query,e.error=r.message}return e},exports.commonOperatorMap={and:"&",or:"|",eq:"=",ne:"!=",le:"<=",ge:">=",lt:"<",gt:">"};var o=exports.autoConverted={true:!0,false:!1,null:null,undefined:void 0,Infinity:1/0,"-Infinity":-1/0};return exports.converters={auto:function(e){if(o.hasOwnProperty(e))return o[e];var r=+e;return isNaN(r)||r.toString()!==e?(e=decodeURIComponent(e),exports.jsonQueryCompatible&&"'"==e.charAt(0)&&"'"==e.charAt(e.length-1)?JSON.parse('"'+e.substring(1,e.length-1)+'"'):e):r},number:function(e){var r=+e;if(isNaN(r))throw new URIError("Invalid number "+r);return r},epoch:function(e){var r=new Date(+e);if(isNaN(r.getTime()))throw new URIError("Invalid date "+e);return r},isodate:function(e){var r="0000".substr(0,4-e.length)+e;return r+="0000-01-01T00:00:00Z".substring(r.length),exports.converters.date(r)},date:function(e){var r,t=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,3}))?Z$/.exec(e);if(r=t?new Date(Date.UTC(+t[1],+t[2]-1,+t[3],+t[4],+t[5],+t[6],+t[7]||0)):new Date(e),isNaN(r.getTime()))throw new URIError("Invalid date "+e);return r},boolean:function(e){return"true"===e},string:function(e){return decodeURIComponent(e)},re:function(e){return new RegExp(decodeURIComponent(e),"i")},RE:function(e){return new RegExp(decodeURIComponent(e))},glob:function(e){var r=decodeURIComponent(e).replace(/([\\|\||\(|\)|\[|\{|\^|\$|\*|\+|\?|\.|\<|\>])/g,function(e){return"\\"+e}).replace(/\\\*/g,".*").replace(/\\\?/g,".?");return r=".*"!==r.substring(0,2)?"^"+r:r.substring(2),".*"!==r.substring(r.length-2)?r+="$":r=r.substring(0,r.length-2),new RegExp(r,"i")}},exports.converters.default=exports.converters.auto,exports.Query=function(){this.name="and",this.args=[]},exports}.apply(exports,t))&&(e.exports=n)},function(e,exports,r){!function(e,t){"use strict";var n=function(){return r(0)},o=function(){return r(3)};e.module("rql",[]).factory("rqlParser",n).factory("rqlQuery",o)}(angular,window)},function(e,exports,r){var t,n;t=[],void 0!==(n=function(){function e(e,r){for(var t=0,n=e.length;t<n;t++)if(e[t]===r)return!0}return e}.apply(exports,t))&&(e.exports=n)},function(e,exports,r){var t,n;t=[exports,r(0),r(4)],void 0!==(n=function(exports,e,t){function n(e){this.name=e||"and",this.args=[]}function o(e,r){for(var t=[],n=0,o=e.length;n<o;n++)t.push(i(e[n]));return t.join(r)}function i(e){return e instanceof Array?"("+o(e,",")+")":e&&e.name&&e.args?[e.name,"(",o(e.args,","),")"].join(""):exports.encodeValue(e)}function a(e){return"string"==typeof e&&(e=encodeURIComponent(e),e.match(/[\(\)]/)&&(e=e.replace("(","%28").replace(")","%29"))),e}var u=e.parseQuery;try{var c=r(5).when}catch(e){c=function(e,r){r(e)}}return e.Query=function(e,r){if("string"==typeof e)return u(e,r);var t=new n;return e&&e.name&&e.args&&(t.name=e.name,t.args=e.args),t},exports.Query=e.Query,exports.knownOperators=["sort","match","in","out","or","and","select","contains","excludes","values","limit","distinct","recurse","aggregate","between","sum","mean","max","min","count","first","one","eq","ne","le","ge","lt","gt"],exports.knownScalarOperators=["mean","sum","min","max","count","first","one"],exports.arrayMethods=["forEach","reduce","map","filter","indexOf","some","every"],exports.Query.prototype=n.prototype,n.prototype.toString=function(){return"and"===this.name?o(this.args,"&"):i(this)},exports.encodeValue=function(r){var t;if(null===r&&(r="null"),r!==e.converters.default(""+(r.toISOString&&r.toISOString()||r.toString()))){var n=typeof r;if(r instanceof RegExp){r=r.toString();var o=r.lastIndexOf("/");n=r.substring(o).indexOf("i")>=0?"re":"RE",r=a(r.substring(1,o)),t=!0}"object"===n&&(n="epoch",r=r.getTime(),t=!0),"string"===n&&(r=a(r),t=!0),r=[n,r].join(":")}return t||"string"!=typeof r||(r=a(r)),r},exports.updateQueryMethods=function(){t(exports.knownOperators,function(e){n.prototype[e]=function(){var r=new n;r.executor=this.executor;var t=new n(e);return t.args=Array.prototype.slice.call(arguments),r.args=this.args.concat([t]),r}}),t(exports.knownScalarOperators,function(e){n.prototype[e]=function(){var r=new n;r.executor=this.executor;var t=new n(e);return t.args=Array.prototype.slice.call(arguments),r.args=this.args.concat([t]),r.executor(r)}}),t(exports.arrayMethods,function(e){n.prototype[e]=function(){var r=arguments;return c(this.executor(this),function(t){return t[e].apply(t,r)})}})},exports.updateQueryMethods(),n.prototype.walk=function(e,r){function t(r,o){o=o||[];for(var i,a,u,c,s=0,f=o.length;s<f;s++)i=o[s],null==i&&(i={}),u=i.name,a=i.args,u&&a&&(a[0]instanceof n?t.call(this,u,a):(c=e.call(this,u,a))&&c.name&&c.ags&&(o[s]=c))}r=r||{},t.call(this,this.name,this.args)},n.prototype.push=function(e){return this.args.push(e),this},n.prototype.normalize=function(e){function r(r,o){if("sort"===r||"select"===r){t[r]=o;var i=n[r];t[r+"Arr"]=t[r].map(function(e){e instanceof Array&&(e=e.join("."));var r={},t=/([-+]*)(.+)/.exec(e);return r[t[2]]=i[1*("-"===t[1].charAt(0))],r}),t[r+"Obj"]={},t[r].forEach(function(e){e instanceof Array&&(e=e.join("."));var n=/([-+]*)(.+)/.exec(e);t[r+"Obj"][n[2]]=i[1*("-"===n[1].charAt(0))]})}else if("limit"===r){var a=o;t.skip=+a[1]||0,a=+a[0]||0,e.hardLimit&&a>e.hardLimit&&(a=e.hardLimit),t.limit=a,t.needCount=!0}else if("values"===r)t.values=!0;else if("eq"===r){var u=typeof o[1];o[0]!==e.primaryKey||"string"!==u&&"number"!==u||(t.pk=String(o[1]))}}e=e||{},e.primaryKey=e.primaryKey||"id",e.map=e.map||{};var t={original:this,sort:[],limit:[1/0,0,1/0],skip:0,limit:1/0,select:[],values:!1},n={sort:[1,-1],select:[1,0]};return this.walk(r),t},exports}.apply(exports,t))&&(e.exports=n)},function(e,exports,r){var t,n;t=[],void 0!==(n=function(){function e(e,r){var t,n;r.length>1&&(n=[],t=function(e){n.push(e)});for(var o=0,i=e.length;o<i;o++)if(r(e[o],t))return n||!0;return n}return e}.apply(exports,t))&&(e.exports=n)},function(e,exports,r){var t;!function(n){void 0!==(t=function(require,exports){function e(e){return new r(e)}function r(e){function t(e){var r=exports.currentContext;if(i)throw new Error("This deferred has already been resolved");try{r!==p&&(r&&r.suspend&&r.suspend(),exports.currentContext=p,p&&p.resume&&p.resume()),o=e,i=!0;for(var t=0;t<f.length;t++)n(f[t])}finally{r!==p&&(p&&p.suspend&&p.suspend(),r&&r.resume&&r.resume(),exports.currentContext=r)}}function n(e){var r=c?e.error:e.resolved;if(r){s?s.handled=!0:s=!0;try{var t=r(o);if(t&&"function"==typeof t.then)return void t.then(e.deferred.resolve,e.deferred.reject);e.deferred.resolve(t)}catch(r){e.deferred.reject(r)}}else c?e.deferred.reject(o,"object"==typeof s?s:s={}):e.deferred.resolve.call(e.deferred,o)}var o,i,c,s,f=[],l=this.promise=new u,p=exports.currentContext;this.resolve=this.callback=this.emitSuccess=function(e){t(e)};var h=this.reject=this.errback=this.emitError=function(e,r){return"object"==typeof r&&(s?r.handled=!0:s=r),c=!0,t(e),r||"undefined"==typeof setTimeout||("object"==typeof s?s.handled:s)||setTimeout(function(){if(!("object"==typeof s?s.handled:s))throw e},exports.errorTimeout),s};this.progress=function(e){for(var r=0;r<f.length;r++){var t=f[r].progress;t&&t(e)}},this.then=l.then=function(e,t,o){var a=new r(l.cancel),u={resolved:e,error:t,progress:o,deferred:a};return i?n(u):f.push(u),a.promise};var d;"undefined"!=typeof setTimeout&&(this.timeout=function(e){return void 0===e?d:(d=e,setTimeout(function(){i||(l.cancel?l.cancel(new Error("timeout")):h(new Error("timeout")))},e),l)}),e&&(this.cancel=l.cancel=function(){var r=e();r instanceof Error||(r=new Error(r)),h(r)}),a(l)}function t(e,t,n){try{if((e=e&&"function"==typeof e.then?t(e):n(e))&&"function"==typeof e.then)return e;var o=new r;return o.resolve(e),o.promise}catch(e){var o=new r;return o.reject(e),o.promise}}function n(e){throw e}function o(e){return e&&e.constructor&&"GeneratorFunction"==e.constructor.name}function i(r){var t=e();return function e(n,o){var i;try{i=o?r.throw(n):r.next(n)}catch(e){return t.reject(e)}if(i.done)return t.resolve(i.value);exports.when(i.value,e,function(r){e(r,!0)})}(),t.promise}exports.errorTimeout=100;var a=Object.freeze||function(){},u=function(e){};u.prototype.then=function(e,r,t){throw new TypeError("The Promise base class is abstract, this function must be implemented by the Promise implementation")},u.prototype.get=function(e){return this.then(function(r){return r[e]})},u.prototype.put=function(e,r){return this.then(function(t){return t[e]=r})},u.prototype.call=function(e){var r=Array.prototype.slice.call(arguments,1);return this.then(function(t){return t[e].apply(t,r)})},u.prototype.resolverCallback=function(e){var r=this;return function(){try{r.resolve(e())}catch(e){r.reject(e)}}},u.prototype.addCallback=function(e){return this.then(e)},u.prototype.addErrback=function(e){return this.then(function(){},e)},u.prototype.addBoth=function(e){return this.then(e,e)},u.prototype.addCallbacks=function(e,r){return this.then(e,r)},u.prototype.wait=function(){return exports.wait(this)},r.prototype=u.prototype,exports.Promise=exports.Deferred=exports.defer=e,Object.defineProperty&&Object.defineProperty(exports,"currentContext",{set:function(e){currentContext=e},get:function(){return currentContext}}),exports.currentContext=null,exports.whenPromise=function(r,t,o,i){var a=e();return r&&"function"==typeof r.then?(r.then(function(e){a.resolve(e)},function(e){a.reject(e)}),o=o||n):a.resolve(r),a.promise.then(t,o,i)},exports.when=function(e,r,t,n){return e&&"function"==typeof e.then?e instanceof u?e.then(r,t,n):exports.whenPromise(e,r,t,n):r?r(e):e},exports.whenCall=function(e,r,t,n){try{return exports.when(e(),r,t,n)}catch(e){return t(e)}},exports.get=function(e,r){return t(e,function(e){return e.get(r)},function(e){return e[r]})},exports.call=function(e,r,n){return t(e,function(e){return e.call(r,n)},function(e){return e[r].apply(e,n)})},exports.put=function(e,r,n){return t(e,function(e){return e.put(r,n)},function(e){return e[r]=n})};var c;exports.wait=function(e){if(!c)throw new Error("Can not wait, the event-queue module is not available");if(e&&"function"==typeof e.then){var r,t,n;for(e.then(function(e){r=!0,n=e},function(e){r=!0,t=!0,n=e});!r;)c.processNextEvent(!0);if(t)throw n;return n}return e},exports.all=function(e){var t=new r;"[object Array]"!==Object.prototype.toString.call(e)&&(e=Array.prototype.slice.call(arguments));var n=0,o=e.length,i=!1,a=[];return 0===o?t.resolve(a):e.forEach(function(e,r){exports.when(e,function(e){a[r]=e,++n===o&&t.resolve(a)},function(e){i||t.reject(e),i=!0})}),t.promise},exports.allKeys=function(e){var t=new r,n=Object.keys(e),o=0,i=n.length,a={};return 0===i?t.resolve(a):n.forEach(function(r){exports.when(e[r],function(e){a[r]=e,++o===i&&t.resolve(a)},t.reject)}),t.promise},exports.first=function(e){var t=new r;"[object Array]"!==Object.prototype.toString.call(e)&&(e=Array.prototype.slice.call(arguments));var n;return e.forEach(function(e,r){exports.when(e,function(e){n||(n=!0,t.resolve(e))},function(e){n||(n=!0,t.resolve(e))})}),t.promise},exports.seq=function(e,t){function n(r){var t=e.shift();t?exports.when(t(r),n,function(e){o.reject(e,!0)}):o.resolve(r)}e=e.concat();var o=new r;return n(t),o.promise},"undefined"!=typeof setTimeout&&(exports.delay=function(e){var t=new r;return setTimeout(function(){t.resolve()},e),t.promise}),exports.execute=function(e){var t=Array.prototype.slice.call(arguments,1),n=new r;return t.push(function(e,r){e?n.emitError(e):arguments.length>2?(Array.prototype.shift.call(arguments,1),n.emitSuccess(arguments)):n.emitSuccess(r)}),e.apply(this,t),n.promise},exports.spawn=function(e){return o(e)&&(e=e()),i(e)},exports.convertNodeAsyncFunction=function(e,t){var n=e.length;return function(){var o=new r;return t&&(n=arguments.length+1),arguments.length=n,arguments[n-1]=function(e,r){e?o.emitError(e):arguments.length>2?(Array.prototype.shift.call(arguments,1),o.emitSuccess(arguments)):o.emitSuccess(r)},e.apply(this,arguments),o.promise}},exports.as=function(r){if(r instanceof u)return r;var t=e();return t.resolve(r),t}}.call(exports,r,exports,e))&&(e.exports=t)}(r(6))},function(e,exports){e.exports=function(){throw new Error("define cannot be used indirect")}}]);
//# sourceMappingURL=rql.min.js.map